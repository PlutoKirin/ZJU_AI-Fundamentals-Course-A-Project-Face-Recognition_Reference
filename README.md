# AI Fundamentals Course A Project: Face Recognition
本项目主要依托`人脸检测数据集.zip`与`dlib`组件进行班级内人脸识别的训练与验证，并附加了签到、活体检测功能，实时准确率可达40%，图片准确率可达70%。
`dlib`组件为`dlib_face_recognition_resnet_model_v1.dat`（人脸识别模型）和`shape_predictor_68_face_landmarks.dat`（人脸关键点检测模型）
且由四个py文件构成
下面将详细介绍

---

## ​ `dlib_face_recognition_resnet_model_v1.dat`
这是一个基于**ResNet架构**的深度学习模型，其作用为输入一张对齐后的人脸图像，输出一个**128维的特征向量（嵌入向量）​**，通过欧氏距离衡量人脸的相似性。
$$\rm{Distance}=\sqrt{\sum_{i=1}^{128}（x_i-y_i）^2}$$

---

## ​`shape_predictor_68_face_landmarks.dat`
这是一个一个**68点人脸关键点检测器**，用于定位人脸的眉毛、眼睛、鼻子、嘴巴、轮廓等特征点。
68点人脸关键点主要为眉毛（8点×2）、眼睛（6点×2）、鼻子（9点）、嘴巴（20点）、下巴（17点）。
其在项目中的作用主要为
1. 人脸对齐：通过关键点调整人脸姿态（如旋转、缩放），使输入图像标准化，提升识别精度。
2. 辅助特征提取：使得对齐后的人脸图像更适合`dlib_face_recognition_resnet_model_v1.dat`处理。

---
## UI_setup.py​

| 模块             | 功能                                  |
| -------------- | ----------------------------------- |
| ​**工具函数**​     | 计算眼睛/嘴巴纵横比、点头/摇头动作判断                |
| ​**人脸识别**​     | 核心识别逻辑（特征比对+标注绘制）                   |
| ​**活体检测**​     | 眨眼、张嘴、头部动作验证                        |
| ​**Gradio界面**​ | 5个交互式选项卡的Web界面                      |

1. ​**签到系统**​
    - 实时摄像头画面 + 签到名单
    - 开始/停止签到按钮
    - 阈值调节滑块
2. ​**详细识别结果**​
    - 显示人脸框坐标和置信度
    - 可开关FPS显示
3. ​**图片人脸识别**​
    - 上传图片批量识别
    - 输出带标注的图片和文字报告
4. ​**活体检测**​
    - 分步骤引导完成动作验证
    - 实时反馈检测进度
5. ​**系统参数设置**​
    - 展示评估指标（混淆矩阵、准确率）
    - 超参数调整指南

---

## ​代码结构说明​

|模块|功能描述|
|---|---|
|`train_face_model.py`|训练模型并生成特征数据库，输出评估报告（混淆矩阵、ROC曲线等）|
|`image_recognition.py`|对指定目录中的图片批量进行人脸识别，标注结果并显示置信度|
|`real_time_recognition.py`|调用摄像头实时识别人脸，适用于动态场景（如考勤签到）|

---

### ​模型训练模块 (`train_face_model.py`)​​​

- 从数据集中提取人脸特征，构建特征数据库
- 划分训练集/测试集（默认8:2比例），至少保证有一张图片用于测试集
- 生成模型评估报告（准确率、混淆矩阵、ROC曲线）
​

|函数名|输入|输出|功能说明|
|---|---|---|---|
|`extract_face_features`|数据集路径、测试集比例|特征字典（`face_features.pkl`）|提取特征并划分数据集|
|`evaluate_model`|特征字典、测试集、阈值|评估报告（图片格式，保存至`evaluation/`）|计算性能指标并可视化|
数据集要求如下​
```markdown
Face_Detection_Dataset/
├── zhangsan/
│   ├── 1.jpg
│   └── 2.jpg
└── lisi/
    ├── 1.jpg
    └── 2.jpg
```

---

### ​静态图片识别模块 (`image_recognition.py`)​​

- 批量处理指定目录（`demo/`）下的图片文件（支持 `.jpg, .png`）
- 标注识别结果（姓名 + 置信度百分比）
- 按图片顺序逐张显示结果（按任意键切换下一张）

核心参数`RECOGNITION_THRESHOLD`
```python
# demo
RECOGNITION_THRESHOLD = 0.45  # 判定阈值（欧氏距离<0.45视为同一人）
```

### ​实时视频识别模块 (`real_time_recognition.py`)​​​

- 调用摄像头实时捕获视频流（默认设备索引为0）
- 实时标注识别结果（无置信度显示，优化计算效率）

---

### ​参数调优建议​

|参数|推荐范围|影响说明|
|---|---|---|
|`RECOGNITION_THRESHOLD`|0.4-0.6|值越小判定越严格（减少误报，但增加漏报）|
|`test_ratio`（训练模块）|0.1-0.3|测试集比例，影响评估结果可信度|

---

### ​扩展数据库​

- 新增人物时，只需在数据集中添加对应文件夹并重新运行训练模块

## ​环境配置​
### ​依赖库
python环境：3.8
`conda create -n py38 python=3.8 -y`

库环境
```bash
conda install -c conda-forge numpy=1.21.5 opencv=4.5.5 dlib=19.24 -y
```
通过**conda-forge渠道**避免Cmake等支持库的安装​

再安装剩余库
```bash
pip install scikit-learn matplotlib seaborn gradio==3.47.0
# 最新版本gradio用value调用Webcam，而会出现浏览器无法调用电脑摄像头的问题，因此指定版本3.47.0，此版本用source调用Webcam，无上述问题
```

---

## ​版权声明​
代码遵循 MIT 开源协议，模型文件（`.dat`）版权归dlib官方所有。